<!DOCTYPE html>
<html>
<head>
    <title>FCM Notification Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .log { background: #f5f5f5; padding: 10px; margin: 10px 0; border-left: 4px solid #007cba; }
        .error { border-color: #dc3545; background: #f8d7da; }
        .success { border-color: #28a745; background: #d4edda; }
        .warning { border-color: #ffc107; background: #fff3cd; }
    </style>
</head>
<body>
    <h1>üîî FCM Notification Debug Tool</h1>
    <p>This tool helps debug FCM notification issues by showing real-time logs.</p>
    
    <div id="logs"></div>
    
    <script>
        const logsDiv = document.getElementById('logs');
        
        function addLog(message, type = 'log') {
            const logDiv = document.createElement('div');
            logDiv.className = `log ${type}`;
            logDiv.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            logsDiv.appendChild(logDiv);
            logsDiv.scrollTop = logsDiv.scrollHeight;
        }
        
        // Check Firebase availability
        addLog('üî• Checking Firebase availability...');
        
        // Check service worker
        if ('serviceWorker' in navigator) {
            addLog('‚úÖ Service Worker supported', 'success');
            
            navigator.serviceWorker.getRegistrations().then(registrations => {
                addLog(`üìù Found ${registrations.length} service worker registrations`, 'success');
                registrations.forEach((reg, index) => {
                    addLog(`SW ${index + 1}: ${reg.scope}`, 'success');
                });
            });
        } else {
            addLog('‚ùå Service Worker not supported', 'error');
        }
        
        // Check notifications permission
        if ('Notification' in window) {
            addLog(`üîî Notification permission: ${Notification.permission}`, 
                Notification.permission === 'granted' ? 'success' : 'warning');
        } else {
            addLog('‚ùå Notifications not supported', 'error');
        }
        
        // Monitor console logs for Firebase messages
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            const message = args.join(' ');
            if (message.includes('Firebase') || message.includes('FCM') || message.includes('notification')) {
                addLog(`üìù LOG: ${message}`, 'log');
            }
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            const message = args.join(' ');
            if (message.includes('Firebase') || message.includes('FCM') || message.includes('notification')) {
                addLog(`‚ùå ERROR: ${message}`, 'error');
            }
            originalError.apply(console, args);
        };
        
        console.warn = function(...args) {
            const message = args.join(' ');
            if (message.includes('Firebase') || message.includes('FCM') || message.includes('notification')) {
                addLog(`‚ö†Ô∏è WARNING: ${message}`, 'warning');
            }
            originalWarn.apply(console, args);
        };
        
        addLog('üéØ Debug tool ready! Open a ticket in another tab and watch for notifications here.');
        
        // Test notification
        function testNotification() {
            if (Notification.permission === 'granted') {
                new Notification('Test Notification', {
                    body: 'This is a test to verify notifications work',
                    icon: '/IThelp/favicon.ico'
                });
                addLog('üß™ Test notification sent', 'success');
            } else {
                addLog('üö´ Cannot test - no notification permission', 'warning');
            }
        }
        
        // Add test button
        const testBtn = document.createElement('button');
        testBtn.textContent = 'üß™ Test Notification';
        testBtn.onclick = testNotification;
        testBtn.style.padding = '10px 20px';
        testBtn.style.margin = '20px 0';
        testBtn.style.backgroundColor = '#007cba';
        testBtn.style.color = 'white';
        testBtn.style.border = 'none';
        testBtn.style.borderRadius = '5px';
        testBtn.style.cursor = 'pointer';
        
        document.body.insertBefore(testBtn, logsDiv);
    </script>
</body>
</html>